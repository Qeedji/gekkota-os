/*! *****************************************************************************
 * GktFileSystem
 * @version v1.2.1
 * @build Mon, 19 Jul 2021 14:17:01 GMT

Proprietary license. Rev 001A, 2021, INNES SA (labs@innes.fr). All rights are reserved.
This proprietary license does not allow the modification of the source code or its redistribution without the written consent of the CEO of INNES SA.
The inspection of the source code for a use strictly intended for a need for IT security analysis is accepted on the condition that INNES SA can be notified of any security breach detected at least 4 weeks before any communication.
This license is governed by French law. All any dispute which may arise therefrom will fall within the exclusive jurisdiction of the Tribunal de RENNES (FR) trade.
***************************************************************************** */
var GktFileSystem=function(t){"use strict";let i="newInputStreamFromString",e="E_INTERNAL_ERROR",n="newInputStreamFromArrayBuffer",r="asyncReadIntoString",o="asyncReadArrayBuffer",a="VIDEO_QUICKTIME",l="VIDEO_OGG",s="VIDEO_MPEG",c="VIDEO_MP4",p="VIDEO_MATROSKA",A="TEXT_HTML",I="TEXT_CACHE_MANIFEST",P="TETX_TAB_SEPARATED_VALUES",T="IMAGE_PNG",_="IMAGE_JPEG",E="AUDIO_MATROSKA",u="APPLICATION_ZIP",f="APPLICATION_XSPF_XML",h="APPLICATION_XSLT_XML",d="APPLICATION_XPF_XML",O="APPLICATION_XML",m="APPLICATION_X509_USER_CERT",L="APPLICATION_X509_SERVER_CERT",M="APPLICATION_X509_EMAIL_CERT",w="APPLICATION_X509_CA_CERT",C="APPLICATION_WGT",N="APPLICATION_URI_XML",x="APPLICATION_SMOOTHSTREAMING",S="APPLICATION_SMIL_XML",y="APPLICATION_SHOCKWAVE_FLASH",v="APPLICATION_SDP",R="APPLICATION_RDF_XML",g="APPLICATION_PLAYLIST_XML",X="APPLICATION_PLAYFOLDER_XML",D="APPLICATION_PLAYFOLDER_RULE_XML",G="APPLICATION_PLAYFILE_RULE_XML",F="APPLICATION_PDF",b="APPLICATION_P12",U="APPLICATION_OF_OD_SM_SHEET",V="APPLICATION_OF_OD_PM_SLIDESHOW",k="APPLICATION_OF_OD_PM_PRESENTATION",j="APPLICATION_ODT",B="APPLICATION_ODP",W="APPLICATION_OCTET_STREAM",J="APPLICATION_MXF",H="APPLICATION_MS_POWERPOINT",K="APPLICATION_MS_EXCEL",Y="APPLICATION_MAFF",z="APPLICATION_M3U8",Z="APPLICATION_JSON",$="APPLICATION_JAVASCRIPT",q="APPLICATION_FRM",Q="APPLICATION_FONT_WOFF2",tt="APPLICATION_FONT_WOFF",it="APPLICATION_FONT_TTF",et="APPLICATION_EOT",nt="APPLICATION_DASH",rt="APPLICATION_APPI",ot="PLAYFOLDER_RULE",at="removeEventListener",lt="E_NO_MORE_SPACE",st="verifySpaceAvailable",ct="E_CANCELED",pt="E_ALREADY_EXISTS",At="E_ACCESS_DENIED",It="E_PARENT_DIRECTORY_NOT_EXISTS",Pt="E_INVALID_ARG",Tt="E_NETWORK",_t="path",Et="progress",ut="value";function ft(t,i,e,n){return new(e||(e=Promise))((function(r,o){function a(t){try{s(n.next(t))}catch(t){o(t)}}function l(t){try{s(n.throw(t))}catch(t){o(t)}}function s(t){var i;t.done?r(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(a,l)}s((n=n.apply(t,i||[])).next())}))}function ht(t,i,e,n){if("a"===e&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!n:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?n:"a"===e?n.call(t):n?n.value:i.get(t)}const dt=Components.interfaces.nsIIOManager,Ot=dt.READONLY,mt=dt.READWRITE,Lt="directory";let Mt,wt,Ct;class Nt{constructor(t,i,e){this.t=t,this.i=i,this.o=e,this.l={}}execute(){return ft(this,void 0,void 0,(function*(){const t=yield this.t.h(this.i),i=(0,this.o)(t,((t,i)=>{if(null!=this.u){const e={lengthComputable:!0,loaded:t,total:i};(0,this.u)(e)}}),this.l);return i instanceof Promise?yield i:i}))}cancel(){if(null!=this.l.l){return(0,this.l.l)(),!0}return!1}addListener(t,i){t===Et&&(this.u=i)}removeListener(t){t===Et&&delete this.u}removeListeners(){delete this.u}}function xt(t){try{let i=t;try{for(;;){const t=i.writeEntry;if(null==t)break;i=t}}catch(t){}return i.fileUri||i.path}catch(i){return t.path}}function St(t){if(!t.exists)throw new Error("E_NOT_EXISTS")}function yt(t,i,e){return new Promise(((n,r)=>{let o;try{const a=(t,i)=>{null!=e&&(e.l=o),0===t?n(i):r(new Error(Tt))};let l;l=null!=i?t(a,i):t(a);const s=l;null!=e&&null!=s&&(o=e.l,e.l=null==o?s.cancel.bind(s):function(){null!=o&&o(),s.cancel()})}catch(t){throw new Error(Tt)}}))}function vt(t){const i=t.lastIndexOf("/");return i<0?t:t.substr(i+1)}function Rt(){if(null==Ct){const t=ioManager.getEntry("/",null,null,Ot);Ct=new Mt("","/","",!0,t)}return Ct}var gt;class Xt{constructor(t,i,e,n,r,o){gt.set(this,void 0);const a=function(t,i,e,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof i?t!==i||!r:!i.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(t,e):r?r.value=e:i.set(t,e),e}(this,gt,{_:o,R:e},"f");Object.defineProperties(this,{name:{[ut]:t},[_t]:{[ut]:i}}),null!=r&&r.exists&&this.A(a,r,n)}get label(){const t=ht(this,gt,"f");return null==t.N?this.path:t.N}get uri(){return ht(this,gt,"f").R}get parent(){const t=ht(this,gt,"f");if(null!=t._)return t._;if("/"===this.path)return this;let i=this.path;i.endsWith("/")&&(i=i.substr(0,i.length-1));let e=i.lastIndexOf("/");if(e<=0)return Rt();i=i.substring(0,e);let n=this.uri;n.endsWith("/")&&(n=n.substr(0,n.length-1)),e=n.lastIndexOf("/"),n=n.substring(0,e);const r=vt(i);return t._=new Mt(r,i+"/",n+"/",!0),t._}move(t,i,e){if(!(t instanceof Mt))throw new Error(Pt);const n=t;return new Nt(this,!0,(t=>ft(this,void 0,void 0,(function*(){St(t);if(!(yield n.h(!0)).exists)throw new Error(It);if(!t.canWrite)throw new Error(At);let r;if(r=this.type===Lt?n.newDirectory(i):n.newFile(i),r.path===this.path)throw new Error(Pt);const o=yield r.h(!0);if(!o.canWrite)throw new Error(At);if(null!=e&&e.overwrite){if(r.type===Lt&&o.exists)throw new Error(pt)}else if(o.exists&&r.path.toLowerCase()!==this.path.toLowerCase())throw new Error(pt);try{yield yt(t.asyncMove.bind(t,o)),yield this.T(!1)}catch(t){throw new Error(Tt)}return yield r.T(!0),r}))))}stat(){return new Nt(this,!1,(t=>(St(t),this.stats)))}h(t){return ft(this,void 0,void 0,(function*(){const i=ht(this,gt,"f");let e=i.I;return null!=e&&t===!i.S||(null!=e&&this.D(),e=yield yt(ioManager.asyncGetEntry.bind(ioManager,this.path,null,null,t?mt:Ot)),this.A(i,e,!1)),e}))}O(t,i){try{t.id=i.uuid}catch(e){t.id=i.path}try{t.lastModified=new Date(i.lastModifiedTime)}catch(i){delete t.lastModified}try{t.etag=i.etag}catch(i){delete t.etag}try{t.owner=i.owner}catch(i){delete t.owner}}T(t){return ft(this,void 0,void 0,(function*(){this.D(),t?null!=this.stats&&(yield this.h(!1)):delete this.stats}))}D(){const t=ht(this,gt,"f");null!=t.g&&clearTimeout(t.g),delete t.g,delete t.I}A(t,i,e){if(t.I=i,t.S=e,t.g=setTimeout(this.D.bind(this),5e3),i.exists){const e=Object.create(null);this.stats=e,e.id="",this.O(e,i),Object.freeze(e),t.R=xt(i)}else delete this.stats;return t}}function Dt(t){if(t.startsWith("/"))throw new Error(Pt);return t.endsWith("/")?t.substr(0,t.length-1):t}function Gt(t,i,e,n,r){return ft(this,void 0,void 0,(function*(){let o=0;const a=[{C:i,m:e}];for(;;){const l=a.pop();if(null==l)break;let s;try{s=(yield yt(ioManager.asyncGetChildEntries.bind(ioManager,l.C.path,null,null))).enumerator}catch(t){throw new Error("E_ERROR")}if(n[0])throw new Error(ct);for(;s.hasMoreElements();){const{name:n,value:c}=s.getNext(),p=Dt(n);let A;c.isDirectory?(A=i===e?c:yield yt(ioManager.asyncGetEntry.bind(ioManager,`${l.m.path}${p}/`,null,null,dt.READWRITE)),t&&a.push({C:c,m:A})):(o+=c.size,A=i===e?c:yield yt(ioManager.asyncGetEntry.bind(ioManager,`${l.m.path}${p}`,null,null,dt.READWRITE))),r(c,A,p,l.C,l.m)}}return o}))}gt=new WeakMap;class Ft extends Xt{list(t){const i=null!=t&&!0===t.deep;return new Nt(this,!1,((t,e,n)=>{const r=[!1];n.l=()=>{r[0]=!0},St(t);const o=[],a={[t.path]:this};return Gt(i,t,t,r,((t,e,n,r)=>{const l=t.path,s=xt(t),c=a[r.path];if(t.isDirectory){const e=new Ft(n,l,s,!0,t,c);a[l]=e,i||o.push(e)}else o.push(new wt(n,l,s,!0,t,c))})).then((()=>o))}))}mkdir(){return new Nt(this,!0,(t=>ft(this,void 0,void 0,(function*(){if(t.exists)throw new Error(pt);yield yt(t.asyncMkcol.bind(t)),yield this.T(!0)}))))}copy(t,i,e){if("string"!=typeof i&&(e=i,i=this.name),!(t instanceof Ft))throw new Error(Pt);const n=t;return new Nt(this,!1,((t,r,o)=>ft(this,void 0,void 0,(function*(){St(t);const a=yield n.h(!0);if(!a.exists)throw new Error(It);const l=n.newDirectory(i);if(l.path===this.path)throw new Error(Pt);const s=yield l.h(!0);if(!s.canWrite)throw new Error(At);if(s.exists&&(null==e||!0!==e.overwrite))throw new Error(pt);const c=[!1];o.l=()=>{c[0]=!0};const p=[{C:t,m:s}],A=yield Gt(!0,t,s,c,((t,i)=>p.push({C:t,m:i})));if(!a[st](A))throw new Error(lt);let I=0;r(I,A);let P=ioTransactionManager.create();try{for(let t of p){const i=t;try{i.C.isDirectory?i.m.exists||(yield yt(P.asyncMkcol.bind(P,i.m.path,i.m))):(yield yt(P.asyncCopy.bind(P,i.m.path,i.C,i.m),(t=>r(I+t,A)),o),I+=i.C.size)}catch(t){throw new Error(Tt)}if(c[0])throw new Error(ct);r(I,A)}I!==A&&r(A,A);try{return yield yt(P.asyncCommit.bind(P)),P=null,yield l.T(!0),l}catch(t){throw new Error(Tt)}}finally{null!=P&&(yield yt(P.asyncRollback.bind(P)))}}))))}unlink(t){return new Nt(this,!0,((i,e,n)=>ft(this,void 0,void 0,(function*(){if(!i.exists)return;const r=[!1];n.l=()=>{r[0]=!0};const o=[i],a=yield Gt(!0,i,i,r,(i=>{if(null==t||!0!==t.deep)throw new Error("E_NOT_EMPTY");o.push(i)}));let l=0;e(l,a);for(let t of o.reverse()){const i=t;let n;try{n=yield yt(ioManager.asyncGetEntry.bind(ioManager,i.path,null,null,dt.DELETE))}catch(t){throw new Error(Tt)}if(!n.canDelete)throw new Error(At);try{yield yt(n.asyncDelete.bind(n))}catch(t){throw new Error(Tt)}if(r[0])throw new Error(ct);i.isDirectory||(l+=i.size,e(l,a))}l!==a&&e(a,a),yield this.T(!1)}))))}newDirectory(t){const i=(t=Dt(t)).indexOf("/")<0?this:void 0;return new Ft(vt(t),this.path+t+"/",this.uri+t.split("/").map(encodeURIComponent).join("/")+"/",!0,void 0,i)}newFile(t){const i=(t=Dt(t)).indexOf("/")<0?this:void 0;return new wt(vt(t),this.path+t,this.uri+t.split("/").map(encodeURIComponent).join("/"),!0,void 0,i)}}Object.defineProperties(Ft.prototype,{type:{[ut]:Lt}});class bt{constructor(t,i,e,n){this.R=t,this.L=i,this.p=e,this.M=n,this.v={}}execute(){return ft(this,void 0,void 0,(function*(){if(null!=this.P)throw new Error(Pt);const t=this.M;yield t();const i=this.P=new XMLHttpRequest;if(i.open("GET",this.R,!0),i.responseType=this.p,null!=this.L)switch(this.p){case"arraybuffer":case"blob":break;case"document":this.P.overrideMimeType("text/xml;charset="+this.L);break;case"json":this.P.overrideMimeType("application/json;charset="+this.L);break;case"text":default:this.P.overrideMimeType("text/plain;charset="+this.L)}const e=t=>{const i=this.v.progress;if(null!=i)try{i(t)}catch(t){}};let n,r;i.addEventListener(Et,e);try{return yield new Promise(((t,e)=>{n=()=>{e(new Error(Tt))},r=function(){200===this.status?t(this.response):e(new Error("E_LOCKED"))},i.addEventListener("abort",n),i.addEventListener("error",n),i.addEventListener("load",r),i.send()}))}finally{i[at]("load",r),i[at]("abort",n),i[at]("error",n),i[at](Et,e)}}))}cancel(){return null!=this.P&&(this.P.abort(),!0)}addListener(t,i){this.v[t]=i}removeListener(t){delete this.v[t]}removeListeners(){this.v={}}}function Ut(t){return new URL(t,location.href).href}let Vt;function kt(t){return(t=Ut(t)).startsWith(function(){if(null==Vt){try{let t=window;for(;null==Vt;){const i=t.location,e=i.origin;if(null!=e&&""!==e&&"null"!==e&&"undefined"!==e){Vt=e;break}if("about:"!==i.protocol){Vt=i.protocol+"//"+i.host;break}t=t.parent}}catch(t){}finally{if(null==Vt){const t=Ut("./"),i=/^([^/]+\/\/[^/]*)/.exec(t);null!=i&&(Vt=i[1])}}Vt.startsWith("file:/")&&(Vt="file:/")}return Vt}())}const jt={APNG:"apng",APPI:"appi",ASF:"asf",AVI:"avi",BEM:"bem",CRT:"crt",CSS:"css",CSV:"csv",DER:"der",EOF:"eof",EOT:"eot",EPK:"epk",EXE:"exe",FRM:"frm",GIF:"gif",HTM:"htm",HTML:"html",ICS:"ics",ISM:"ism",ISMC:"ismc",JPEG:"jpeg",JPG:"jpg",JS:"js",JSON:"json",LOG:"log",M2V:"m2v",M3U8:"m3u8",M4A:"m4a",M4V:"m4v",MAF:"maf",MAFF:"maff",MANIFEST:"manifest",MD:"md",MJPG:"mjpg",MKA:"mka",MKS:"mks",MKV:"mkv",MOV:"mov",MP3:"mp3",MP4:"mp4",MPD:"mpd",MPEG:"mpeg",MPG:"mpg",MXF:"mxf",ODP:"odp",ODT:"odt",OGA:"oga",OGG:"ogg",OGV:"ogv",OTF:"otf",P12:"p12",PDF:"pdf",PEM:"pem",PLAYFILE_RULE:"playfile-rule",PLAYFOLDER:"playfolder",[ot]:"playfolder-rule",PLAYLIST:"playlist",PNG:"png",PPK:"ppk",PPS:"pps",PPSX:"ppsx",PPT:"ppt",PPTX:"pptx",PS:"ps",SDP:"sdp",SMIL:"smil",SRT:"srt",SVG:"svg",SWF:"swf",TS:"ts",TSV:"tsv",TTC:"ttc",TTF:"ttf",TXT:"txt",URI:"uri",VOB:"vob",VTT:"vtt",WEBM:"webm",WGT:"wgt",WMA:"wma",WMV:"wmv",WOFF:"woff",WOFF2:"woff2",XLS:"xls",XLSX:"xlsx",XML:"xml",XMP:"xmp",XPF:"xpf",XSLT:"xslt",XSPF:"xspf",ZIP:"zip"},Bt={[rt]:"application/appi",APPLICATION_APPLEFILE:"application/applefile",APPLICATION_BINHEX:"application/mac-binhex40",APPLICATION_BROTLI:"application/brotli",APPLICATION_COMPRESS:"application/x-compress",APPLICATION_COMPRESS2:"application/compress",[nt]:"application/dash+xml",APPLICATION_ECMASCRIPT:"application/ecmascript",[et]:"application/vnd.ms-fontobject",[it]:"application/x-font-ttf",[tt]:"application/x-font-woff",[Q]:"application/x-font-woff2",APPLICATION_FORTEZZA_CKL:"application/x-fortezza-ckl",APPLICATION_FORTEZZA_KRL:"application/x-fortezza-krl",[q]:"application/vnd.innes.firmware",APPLICATION_GZIP:"application/x-gzip",APPLICATION_GZIP2:"application/gzip",APPLICATION_GZIP3:"application/x-gunzip",APPLICATION_HTTP_INDEX_FORMAT:"application/http-index-format",APPLICATION_JAVAARCHIVE:"application/java-archive",[$]:"application/javascript",[Z]:"application/json",[z]:"application/vnd.apple.mpegurl",APPLICATION_MACBINARY:"application/x-macbinary",[Y]:"application/x-maff",APPLICATION_MARIMBA:"application/marimba",APPLICATION_MATHML_XML:"application/mathml+xml",[K]:"application/vnd.ms-excel",[H]:"application/vnd.ms-powerpoint",[J]:"application/mxf",APPLICATION_NETSCAPE_REVOCATION:"application/x-netscape-revocation",APPLICATION_NS_JAVASCRIPT_AUTOCONFIG:"application/x-javascript-config",APPLICATION_NS_PROXY_AUTOCONFIG:"application/x-ns-proxy-autoconfig",[W]:"application/octet-stream",[B]:"application/vnd.oasis.opendocument.presentation",[j]:"application/vnd.oasis.opendocument.text",[k]:"application/vnd.openxmlformats-officedocument.presentationml.presentation",[V]:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",[U]:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",APPLICATION_OGG:"application/ogg",APPLICATION_OLEOBJECT:"application/oleobject",APPLICATION_OLEOBJECT2:"application/x-oleobject",[b]:"application/x-pkcs12",APPLICATION_PACKAGE:"application/package",[F]:"application/pdf",APPLICATION_PGP:"application/pgp",APPLICATION_PGP2:"application/x-pgp-message",APPLICATION_PKCS7_MIME:"application/pkcs7-mime",APPLICATION_PKCS7_SIGNATURE:"application/pkcs7-signature",[G]:"application/playfile-rule+xml",[D]:"application/playfolder-rule+xml",[X]:"application/playfolder+xml",[g]:"application/playlist+xml",APPLICATION_POSTSCRIPT:"application/postscript",APPLICATION_PRE_ENCRYPTED:"application/pre-encrypted",[R]:"application/rdf+xml",[v]:"application/sdp",[y]:"application/x-shockwave-flash",[S]:"application/smil+xml",[x]:"application/vnd.ms-sstr+xml",[N]:"application/uri+xml",APPLICATION_UUENCODE:"application/x-uuencode",APPLICATION_UUENCODE2:"application/x-uue",APPLICATION_UUENCODE3:"application/uuencode",APPLICATION_UUENCODE4:"application/uue",APPLICATION_WEB_MANIFEST:"application/manifest+json",[C]:"application/widget",APPLICATION_WWW_FORM_URLENCODED:"application/x-www-form-urlencoded",[w]:"application/x-x509-ca-cert",APPLICATION_X509_CRL:"application/x-pkcs7-crl",[M]:"application/x-x509-email-cert",[L]:"application/x-x509-server-cert",[m]:"application/x-x509-user-cert",APPLICATION_XHTML_XML:"application/xhtml+xml",APPLICATION_XJAVASCRIPT:"application/x-javascript",APPLICATION_XMARIMBA:"application/x-marimba",[O]:"application/xml",[d]:"application/xpf+xml",APPLICATION_XPINSTALL:"application/x-xpinstall",APPLICATION_XPKCS7_MIME:"application/x-pkcs7-mime",APPLICATION_XPKCS7_SIGNATURE:"application/x-pkcs7-signature",[h]:"application/xslt+xml",[f]:"application/xspf+xml",[u]:"application/zip",AUDIO_3GPP:"audio/3gpp",AUDIO_3GPP2:"audio/3gpp2",AUDIO_AMR:"audio/amr",AUDIO_BASIC:"audio/basic",AUDIO_FLAC:"audio/flac",[E]:"audio/x-matroska",AUDIO_MIDI:"audio/x-midi",AUDIO_MP3:"audio/mpeg",AUDIO_MP4:"audio/mp4",AUDIO_OGG:"audio/ogg",AUDIO_WAV:"audio/x-wav",AUDIO_WEBM:"audio/webm",AUDIO_WMA:"audio/x-ms-wma",BINARY_OCTET_STREAM:"binary/octet-stream",FONT_OTF:"font/otf",FONT_TTC:"font/collection",FONT_TTF:"font/ttf",FONT_WOFF:"font/woff",FONT_WOFF2:"font/woff2",IMAGE_ART:"image/x-jg",IMAGE_BMP:"image/bmp",IMAGE_BMP_MS:"image/x-ms-bmp",IMAGE_GIF:"image/gif",IMAGE_ICO:"image/x-icon",IMAGE_ICON_MS:"image/icon",IMAGE_ICO_MS:"image/vnd.microsoft.icon",IMAGE_JNG:"image/x-jng",[_]:"image/jpeg",IMAGE_JPG:"image/jpg",IMAGE_MNG:"video/x-mng",IMAGE_PJPEG:"image/pjpeg",[T]:"image/png",IMAGE_PPK:"image/ppk",IMAGE_PPM:"image/x-portable-pixmap",IMAGE_SVG_XML:"image/svg+xml",IMAGE_TIFF:"image/tiff",IMAGE_XBM:"image/x-xbitmap",IMAGE_XBM2:"image/x-xbm",IMAGE_XBM3:"image/xbm",IMAGE_X_PNG:"image/x-png",MESSAGE_EXTERNAL_BODY:"message/external-body",MESSAGE_NEWS:"message/news",MESSAGE_RFC822:"message/rfc822",MULTIPART_ALTERNATIVE:"multipart/alternative",MULTIPART_APPLEDOUBLE:"multipart/appledouble",MULTIPART_BYTERANGES:"multipart/byteranges",MULTIPART_DIGEST:"multipart/digest",MULTIPART_FORM_DATA:"multipart/form-data",MULTIPART_HEADER_SET:"multipart/header-set",MULTIPART_MIXED:"multipart/mixed",MULTIPART_MIXED_REPLACE:"multipart/x-mixed-replace",MULTIPART_PARALLEL:"multipart/parallel",MULTIPART_RELATED:"multipart/related",MULTIPART_SIGNED:"multipart/signed",SUN_ATTACHMENT:"x-sun-attachment",[P]:"text/tab-separated-values",[I]:"text/cache-manifest",TEXT_CALENDAR:"text/calendar",TEXT_CSS:"text/css",TEXT_CSV:"text/csv",TEXT_ECMASCRIPT:"text/ecmascript",TEXT_ENRICHED:"text/enriched",TEXT_EVENT_STREAM:"text/event-stream",[A]:"text/html",TEXT_JAVASCRIPT:"text/javascript",TEXT_JSON:"text/json",TEXT_JSSS:"text/jsss",TEXT_LOG:"text/log",TEXT_MD:"text/markdown",TEXT_MDL:"text/mdl",TEXT_PLAIN:"text/plain",TEXT_RDF:"text/rdf",TEXT_RICHTEXT:"text/richtext",TEXT_SRT:"text/srt",TEXT_VCARD:"text/vcard",TEXT_VTT:"text/vtt",TEXT_XML:"text/xml",TEXT_XSL:"text/xsl",TEXT_XUL:"application/vnd.mozilla.xul+xml",VIDEO_3GPP:"video/3gpp",VIDEO_3GPP2:"video/3gpp2",VIDEO_AVI:"video/avi",VIDEO_JPEG:"video/JPEG",[p]:"video/x-matroska",[c]:"video/mp4",[s]:"video/mpeg",VIDEO_MPEG_TS:"video/mp2t",VIDEO_MS_ASF:"video/x-ms-asf",[l]:"video/ogg",[a]:"video/quicktime",VIDEO_RAW:"video/x-raw-yuv",VIDEO_RTP:"video/rtp",VIDEO_WEBM:"video/webm",VIDEO_WMV:"video/x-ms-wmv"},Wt={get i(){const t={},i=[Bt[w],Bt[M],Bt[L],Bt[m]];return t[jt.APNG]=[Bt.IMAGE_PNG],t[jt.APPI]=[Bt.APPLICATION_APPI],t[jt.ASF]=[Bt.VIDEO_MS_ASF],t[jt.AVI]=[Bt.VIDEO_AVI],t[jt.BEM]=[Bt[W]],t[jt.CRT]=i,t[jt.CSS]=[Bt.TEXT_CSS],t[jt.CSV]=[Bt.TEXT_CSV],t[jt.DER]=i,t[jt.EOF]=[Bt.APPLICATION_EOT],t[jt.EOT]=[Bt.APPLICATION_EOT],t[jt.EPK]=[Bt[W]],t[jt.EXE]=[Bt[W]],t[jt.FRM]=[Bt.APPLICATION_FRM],t[jt.GIF]=[Bt.IMAGE_GIF],t[jt.HTM]=[Bt.TEXT_HTML],t[jt.HTML]=[Bt.TEXT_HTML],t[jt.ICS]=[Bt.TEXT_CALENDAR],t[jt.ISM]=[Bt[x],Bt.APPLICATION_XML],t[jt.ISMC]=[Bt.APPLICATION_XML],t[jt.JPEG]=[Bt.IMAGE_JPEG],t[jt.JPG]=[Bt.IMAGE_JPEG],t[jt.JS]=[Bt[$]],t[jt.JSON]=[Bt.APPLICATION_JSON],t[jt.LOG]=[Bt.TEXT_LOG],t[jt.M2V]=[Bt.VIDEO_MPEG],t[jt.M3U8]=[Bt.APPLICATION_M3U8],t[jt.M4A]=[Bt.AUDIO_MP4],t[jt.M4V]=[Bt.VIDEO_MP4],t[jt.MAF]=[Bt.APPLICATION_MAFF],t[jt.MAFF]=[Bt.APPLICATION_MAFF],t[jt.MANIFEST]=[Bt[I]],t[jt.MD]=[Bt.TEXT_MD],t[jt.MJPG]=[Bt.VIDEO_JPEG],t[jt.MKA]=[Bt.AUDIO_MATROSKA],t[jt.MKS]=[Bt.VIDEO_MATROSKA],t[jt.MKV]=[Bt.VIDEO_MATROSKA],t[jt.MOV]=[Bt.VIDEO_QUICKTIME],t[jt.MP3]=[Bt.AUDIO_MP3],t[jt.MP4]=[Bt.VIDEO_MP4],t[jt.MPD]=[Bt.APPLICATION_DASH],t[jt.MPEG]=[Bt.VIDEO_MPEG],t[jt.MPG]=[Bt.VIDEO_MPEG],t[jt.MXF]=[Bt.APPLICATION_MXF],t[jt.ODP]=[Bt.APPLICATION_ODP],t[jt.ODT]=[Bt.APPLICATION_ODT],t[jt.OGA]=[Bt.AUDIO_OGG],t[jt.OGG]=[Bt.VIDEO_OGG],t[jt.OGV]=[Bt.VIDEO_OGG],t[jt.OTF]=[Bt.FONT_OTF],t[jt.P12]=[Bt.APPLICATION_P12],t[jt.PDF]=[Bt.APPLICATION_PDF],t[jt.PEM]=i,t[jt.PLAYFILE_RULE]=[Bt[G],Bt.APPLICATION_XML],t[jt.PLAYFOLDER_RULE]=[Bt[D],Bt.APPLICATION_XML],t[jt.PLAYFOLDER]=[Bt[X],Bt.APPLICATION_XML],t[jt.PLAYLIST]=[Bt[g],Bt.APPLICATION_XML],t[jt.PNG]=[Bt.IMAGE_PNG],t[jt.PPK]=[Bt.IMAGE_PPK],t[jt.PPS]=[Bt[H]],t[jt.PPSX]=[Bt[V]],t[jt.PPT]=[Bt[H]],t[jt.PPTX]=[Bt[k]],t[jt.PS]=[Bt.VIDEO_MPEG],t[jt.SDP]=[Bt.APPLICATION_SDP],t[jt.SMIL]=[Bt[S],Bt.APPLICATION_XML],t[jt.SRT]=[Bt.TEXT_SRT],t[jt.SVG]=[Bt.IMAGE_SVG_XML],t[jt.SWF]=[Bt[y]],t[jt.TS]=[Bt.VIDEO_MPEG_TS],t[jt.TSV]=[Bt[P]],t[jt.TTC]=[Bt.FONT_TTC],t[jt.TTF]=[Bt.FONT_TTF,Bt[it]],t[jt.TXT]=[Bt.TEXT_PLAIN],t[jt.URI]=[Bt[N],Bt.APPLICATION_XML],t[jt.VOB]=[Bt.VIDEO_MPEG],t[jt.VTT]=[Bt.TEXT_VTT],t[jt.WEBM]=[Bt.VIDEO_WEBM],t[jt.WGT]=[Bt.APPLICATION_WGT],t[jt.WMA]=[Bt.AUDIO_WMA],t[jt.WMV]=[Bt.VIDEO_WMV],t[jt.WOFF]=[Bt.FONT_WOFF,Bt[tt]],t[jt.WOFF2]=[Bt.FONT_WOFF2,Bt[Q]],t[jt.XLS]=[Bt[K]],t[jt.XLSX]=[Bt[U]],t[jt.XML]=[Bt.APPLICATION_XML],t[jt.XMP]=[Bt[R]],t[jt.XPF]=[Bt[d],Bt.APPLICATION_XML],t[jt.XSLT]=[Bt[h],Bt.APPLICATION_XML],t[jt.XSPF]=[Bt[f],Bt.APPLICATION_XML],t[jt.ZIP]=[Bt.APPLICATION_ZIP],t}}.i;function Jt(t){const i=function(t){const i=function(t){return t.substr(t.lastIndexOf(".")+1).toLowerCase()}(t);return null!=Wt[i]?Wt[i]:[]}(t);return i.length>0?i[0]:null}function Ht(t){return function(t){return null!=t&&null!=t.charset}(t)?t.charset:"UTF-8"}class Kt extends Xt{read(t){return function(t){if(null==t.stats)return!1;const i=t.uri;return!(i.indexOf(":/")<0)&&kt(i)}(this)?new bt(this.uri,Ht(t),null==t?"text":t.responseType,(()=>this.h(!1).then((t=>{St(t)})))):new Nt(this,!1,((i,e,n)=>ft(this,void 0,void 0,(function*(){St(i);const a=i.getInput();try{switch(null==t?"text":t.responseType){case"arraybuffer":{const t=new ArrayBuffer(i.size);return yield yt(a[o].bind(a,i.size,t),e,n),t}case"blob":{const t=new ArrayBuffer(i.size);return yield yt(a[o].bind(a,i.size,t),e,n),new Blob([t])}case"text":return yield yt(a[r].bind(a,i.size,Ht(t)),e,n);case"document":{const o=yield yt(a[r].bind(a,i.size,Ht(t)),e,n);return(new DOMParser).parseFromString(o,"text/xml")}case"json":{const o=yield yt(a[r].bind(a,i.size,Ht(t)),e,n);return JSON.parse(o)}}}finally{a.close()}}))))}write(t,r){return new Nt(this,!0,((o,a,l)=>ft(this,void 0,void 0,(function*(){if((null==r||!r.overwrite)&&o.exists)throw new Error(pt);if(!(yield this.parent.h(!1)).exists)throw new Error(It);if(!o.canWrite)throw new Error(At);let s;if(t instanceof ArrayBuffer)0!==t.byteLength&&(s=ioManager[n](t.byteLength,t));else if(t instanceof Blob){if(0!==t.size)try{s=ioManager.newInputStreamFromBlob(t)}catch(i){const r=yield new Promise(((i,n)=>{const r=new FileReader;r.addEventListener("error",(()=>{n(new Error(e))})),r.addEventListener("load",(function(){null==this.result?n(new Error(e)):i(this.result)})),r.readAsArrayBuffer(t)}));s=ioManager[n](r.byteLength,r)}}else if(t instanceof Document){const e=(new XMLSerializer).serializeToString(t);s=ioManager[i](e,Ht(r))}else{let e=t;"string"!=typeof e&&(e=JSON.stringify(t)),0!==e.length&&(s=ioManager[i](e,Ht(r)))}if(null==s)o.exists&&(yield yt(o.asyncDelete.bind(o))),yield yt(o.asyncCreateFile.bind(o)),yield this.T(!0);else{const t=ioTransactionManager.create();let i=!1;try{let e=0;const n=t.asyncPut.bind(t,o.path,o,s);for(;;){const i=s.available();if(0===i)break;if(!o[st](i))throw new Error(lt);yield yt(n.bind(t,0===e,e,i),a,l),e+=i}try{t.commit()}catch(t){throw new Error(Tt)}yield this.T(!0),i=!0}finally{i||t.rollback()}}}))))}copy(t,i,e){if("string"!=typeof i&&(e=i,i=this.name),!(t instanceof Mt))throw new Error(Pt);const n=t;return new Nt(this,!1,((t,r,o)=>ft(this,void 0,void 0,(function*(){St(t);if(!(yield n.h(!0)).exists)throw new Error(It);const a=n.newFile(i);if(a.path===this.path)throw new Error(Pt);const l=yield a.h(!0);if(!l.canWrite)throw new Error(At);const s=this.stats;if(null!=s.contentLength&&!l[st](s.contentLength))throw new Error(lt);if((null==e||!0!==e.overwrite)&&l.exists)throw new Error(pt);let c=ioTransactionManager.create();try{const i=t.size;r(0,i);try{yield yt(c.asyncCopy.bind(c,l.path,t,l),((t,i)=>r(t,i)),o),yield yt(c.asyncCommit.bind(c))}catch(t){throw new Error(Tt)}return r(i,i),c=null,yield a.T(!0),a}finally{null!=c&&(yield yt(c.asyncRollback.bind(c)))}}))))}unlink(){return new Nt(this,!0,(t=>ft(this,void 0,void 0,(function*(){t.exists&&(yield yt(t.asyncDelete.bind(t)),yield this.T(!1))}))))}O(t,i){super.O(t,i);try{t.contentLength=i.size}catch(t){}const e=this.name.lastIndexOf(".");if(e>0){const i=Jt(this.name.substr(e+1));null!=i&&(t.contentType=i)}}}return Object.defineProperties(Kt.prototype,{type:{[ut]:"file"}}),Mt=Ft,wt=Kt,t.root=Rt,t}({});