/*! *****************************************************************************
 * GktFileSystem
 * @version v1.2.1
 * @build Mon, 19 Jul 2021 14:17:01 GMT

Proprietary license. Rev 001A, 2021, INNES SA (labs@innes.fr). All rights are reserved.
This proprietary license does not allow the modification of the source code or its redistribution without the written consent of the CEO of INNES SA.
The inspection of the source code for a use strictly intended for a need for IT security analysis is accepted on the condition that INNES SA can be notified of any security breach detected at least 4 weeks before any communication.
This license is governed by French law. All any dispute which may arise therefrom will fall within the exclusive jurisdiction of the Tribunal de RENNES (FR) trade.
***************************************************************************** */
const e=Components.interfaces.nsIIOManager,i=e.READONLY,o=e.READWRITE;let s,a,l;function r(t,i,e,a){if("a"===e&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!a:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?a:"a"===e?a.call(t):a?a.value:i.get(t)}class c{constructor(t,i,e){this.t=t,this.i=i,this.o=e,this.l={}}async execute(){const t=await this.t.h(this.i),i=(0,this.o)(t,((t,i)=>{if(null!=this.u){const e={lengthComputable:!0,loaded:t,total:i};(0,this.u)(e)}}),this.l);return i instanceof Promise?await i:i}cancel(){if(null!=this.l.l){return(0,this.l.l)(),!0}return!1}addListener(t,i){"progress"===t&&(this.u=i)}removeListener(t){"progress"===t&&delete this.u}removeListeners(){delete this.u}}function h(t){try{let i=t;try{for(;;){const t=i.writeEntry;if(null==t)break;i=t}}catch{}return i.fileUri||i.path}catch{return t.path}}function w(t){if(!t.exists)throw new Error("E_NOT_EXISTS")}function E(t,i,e){return new Promise(((a,n)=>{let r;try{const o=(t,i)=>{null!=e&&(e.l=r),0===t?a(i):n(new Error("E_NETWORK"))};let l;l=null!=i?t(o,i):t(o);const s=l;null!=e&&null!=s&&(r=e.l,e.l=null==r?s.cancel.bind(s):function(){null!=r&&r(),s.cancel()})}catch{throw new Error("E_NETWORK")}}))}function u(t){const i=t.lastIndexOf("/");return i<0?t:t.substr(i+1)}function f(){if(null==l){const t=ioManager.getEntry("/",null,null,i);l=new s("","/","",!0,t)}return l}var _;class N{constructor(t,i,e,a,n,r){_.set(this,void 0);const o=function(t,i,e,a,n){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof i?t!==i||!n:!i.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?n.call(t,e):n?n.value=e:i.set(t,e),e}(this,_,{_:r,R:e},"f");Object.defineProperties(this,{name:{value:t},path:{value:i}}),null!=n&&n.exists&&this.A(o,n,a)}get label(){const t=r(this,_,"f");return null==t.N?this.path:t.N}get uri(){return r(this,_,"f").R}get parent(){const t=r(this,_,"f");if(null!=t._)return t._;if("/"===this.path)return this;let i=this.path;i.endsWith("/")&&(i=i.substr(0,i.length-1));let e=i.lastIndexOf("/");if(e<=0)return f();i=i.substring(0,e);let a=this.uri;a.endsWith("/")&&(a=a.substr(0,a.length-1)),e=a.lastIndexOf("/"),a=a.substring(0,e);const n=u(i);return t._=new s(n,i+"/",a+"/",!0),t._}move(t,i,e){if(!(t instanceof s))throw new Error("E_INVALID_ARG");const a=t;return new c(this,!0,(async t=>{w(t);if(!(await a.h(!0)).exists)throw new Error("E_PARENT_DIRECTORY_NOT_EXISTS");if(!t.canWrite)throw new Error("E_ACCESS_DENIED");let n;if(n="directory"===this.type?a.newDirectory(i):a.newFile(i),n.path===this.path)throw new Error("E_INVALID_ARG");const r=await n.h(!0);if(!r.canWrite)throw new Error("E_ACCESS_DENIED");if(null!=e&&e.overwrite){if("directory"===n.type&&r.exists)throw new Error("E_ALREADY_EXISTS")}else if(r.exists&&n.path.toLowerCase()!==this.path.toLowerCase())throw new Error("E_ALREADY_EXISTS");try{await E(t.asyncMove.bind(t,r)),await this.T(!1)}catch{throw new Error("E_NETWORK")}return await n.T(!0),n}))}stat(){return new c(this,!1,(t=>(w(t),this.stats)))}async h(t){const e=r(this,_,"f");let a=e.I;return null!=a&&t===!e.S||(null!=a&&this.D(),a=await E(ioManager.asyncGetEntry.bind(ioManager,this.path,null,null,t?o:i)),this.A(e,a,!1)),a}O(t,i){try{t.id=i.uuid}catch{t.id=i.path}try{t.lastModified=new Date(i.lastModifiedTime)}catch{delete t.lastModified}try{t.etag=i.etag}catch{delete t.etag}try{t.owner=i.owner}catch{delete t.owner}}async T(t){this.D(),t?null!=this.stats&&await this.h(!1):delete this.stats}D(){const t=r(this,_,"f");null!=t.g&&clearTimeout(t.g),delete t.g,delete t.I}A(t,i,e){if(t.I=i,t.S=e,t.g=setTimeout(this.D.bind(this),5e3),i.exists){const e=Object.create(null);this.stats=e,e.id="",this.O(e,i),Object.freeze(e),t.R=h(i)}else delete this.stats;return t}}function d(t){if(t.startsWith("/"))throw new Error("E_INVALID_ARG");return t.endsWith("/")?t.substr(0,t.length-1):t}async function T(t,i,a,n,r){let o=0;const l=[{C:i,m:a}];for(;;){const s=l.pop();if(null==s)break;let c;try{c=(await E(ioManager.asyncGetChildEntries.bind(ioManager,s.C.path,null,null))).enumerator}catch{throw new Error("E_ERROR")}if(n[0])throw new Error("E_CANCELED");for(;c.hasMoreElements();){const{name:n,value:A}=c.getNext(),_=d(n);let p;A.isDirectory?(p=i===a?A:await E(ioManager.asyncGetEntry.bind(ioManager,`${s.m.path}${_}/`,null,null,e.READWRITE)),t&&l.push({C:A,m:p})):(o+=A.size,p=i===a?A:await E(ioManager.asyncGetEntry.bind(ioManager,`${s.m.path}${_}`,null,null,e.READWRITE))),r(A,p,_,s.C,s.m)}}return o}_=new WeakMap;class I extends N{list(t){const i=null!=t&&!0===t.deep;return new c(this,!1,((t,e,n)=>{const r=[!1];n.l=()=>{r[0]=!0},w(t);const o=[],l={[t.path]:this};return T(i,t,t,r,((t,e,n,r)=>{const s=t.path,c=h(t),A=l[r.path];if(t.isDirectory){const e=new I(n,s,c,!0,t,A);l[s]=e,i||o.push(e)}else o.push(new a(n,s,c,!0,t,A))})).then((()=>o))}))}mkdir(){return new c(this,!0,(async t=>{if(t.exists)throw new Error("E_ALREADY_EXISTS");await E(t.asyncMkcol.bind(t)),await this.T(!0)}))}copy(t,i,e){if("string"!=typeof i&&(e=i,i=this.name),!(t instanceof I))throw new Error("E_INVALID_ARG");const a=t;return new c(this,!1,(async(t,n,r)=>{w(t);const o=await a.h(!0);if(!o.exists)throw new Error("E_PARENT_DIRECTORY_NOT_EXISTS");const l=a.newDirectory(i);if(l.path===this.path)throw new Error("E_INVALID_ARG");const s=await l.h(!0);if(!s.canWrite)throw new Error("E_ACCESS_DENIED");if(s.exists&&(null==e||!0!==e.overwrite))throw new Error("E_ALREADY_EXISTS");const c=[!1];r.l=()=>{c[0]=!0};const A=[{C:t,m:s}],_=await T(!0,t,s,c,((t,i)=>A.push({C:t,m:i})));if(!o.verifySpaceAvailable(_))throw new Error("E_NO_MORE_SPACE");let p=0;n(p,_);let I=ioTransactionManager.create();try{for(const t of A){try{t.C.isDirectory?t.m.exists||await E(I.asyncMkcol.bind(I,t.m.path,t.m)):(await E(I.asyncCopy.bind(I,t.m.path,t.C,t.m),(t=>n(p+t,_)),r),p+=t.C.size)}catch{throw new Error("E_NETWORK")}if(c[0])throw new Error("E_CANCELED");n(p,_)}p!==_&&n(_,_);try{return await E(I.asyncCommit.bind(I)),I=null,await l.T(!0),l}catch{throw new Error("E_NETWORK")}}finally{null!=I&&await E(I.asyncRollback.bind(I))}}))}unlink(t){return new c(this,!0,(async(i,a,n)=>{if(!i.exists)return;const r=[!1];n.l=()=>{r[0]=!0};const o=[i],l=await T(!0,i,i,r,(i=>{if(null==t||!0!==t.deep)throw new Error("E_NOT_EMPTY");o.push(i)}));let s=0;a(s,l);for(const t of o.reverse()){let i;try{i=await E(ioManager.asyncGetEntry.bind(ioManager,t.path,null,null,e.DELETE))}catch{throw new Error("E_NETWORK")}if(!i.canDelete)throw new Error("E_ACCESS_DENIED");try{await E(i.asyncDelete.bind(i))}catch{throw new Error("E_NETWORK")}if(r[0])throw new Error("E_CANCELED");t.isDirectory||(s+=t.size,a(s,l))}s!==l&&a(l,l),await this.T(!1)}))}newDirectory(t){const i=(t=d(t)).indexOf("/")<0?this:void 0;return new I(u(t),this.path+t+"/",this.uri+t.split("/").map(encodeURIComponent).join("/")+"/",!0,void 0,i)}newFile(t){const i=(t=d(t)).indexOf("/")<0?this:void 0;return new a(u(t),this.path+t,this.uri+t.split("/").map(encodeURIComponent).join("/"),!0,void 0,i)}}Object.defineProperties(I.prototype,{type:{value:"directory"}});class S{constructor(t,i,e,a){this.R=t,this.L=i,this.p=e,this.M=a,this.v={}}async execute(){if(null!=this.P)throw new Error("E_INVALID_ARG");const t=this.M;await t();const i=this.P=new XMLHttpRequest;if(i.open("GET",this.R,!0),i.responseType=this.p,null!=this.L)switch(this.p){case"arraybuffer":case"blob":break;case"document":this.P.overrideMimeType("text/xml;charset="+this.L);break;case"json":this.P.overrideMimeType("application/json;charset="+this.L);break;case"text":default:this.P.overrideMimeType("text/plain;charset="+this.L)}const e=t=>{const i=this.v.progress;if(null!=i)try{i(t)}catch{}};let a,n;i.addEventListener("progress",e);try{return await new Promise(((t,e)=>{a=()=>{e(new Error("E_NETWORK"))},n=function(){200===this.status?t(this.response):e(new Error("E_LOCKED"))},i.addEventListener("abort",a),i.addEventListener("error",a),i.addEventListener("load",n),i.send()}))}finally{i.removeEventListener("load",n),i.removeEventListener("abort",a),i.removeEventListener("error",a),i.removeEventListener("progress",e)}}cancel(){return null!=this.P&&(this.P.abort(),!0)}addListener(t,i){this.v[t]=i}removeListener(t){delete this.v[t]}removeListeners(){this.v={}}}function D(t){return new URL(t,location.href).href}let R;function O(t){return(t=D(t)).startsWith(function(){if(null==R){try{let t=window;for(;null==R;){const i=t.location,e=i.origin;if(null!=e&&""!==e&&"null"!==e&&"undefined"!==e){R=e;break}if("about:"!==i.protocol){R=i.protocol+"//"+i.host;break}t=t.parent}}catch(t){}finally{if(null==R){const t=D("./"),i=/^([^/]+\/\/[^/]*)/.exec(t);null!=i&&(R=i[1])}}R.startsWith("file:/")&&(R="file:/")}return R}())}const p={APNG:"apng",APPI:"appi",ASF:"asf",AVI:"avi",BEM:"bem",CRT:"crt",CSS:"css",CSV:"csv",DER:"der",EOF:"eof",EOT:"eot",EPK:"epk",EXE:"exe",FRM:"frm",GIF:"gif",HTM:"htm",HTML:"html",ICS:"ics",ISM:"ism",ISMC:"ismc",JPEG:"jpeg",JPG:"jpg",JS:"js",JSON:"json",LOG:"log",M2V:"m2v",M3U8:"m3u8",M4A:"m4a",M4V:"m4v",MAF:"maf",MAFF:"maff",MANIFEST:"manifest",MD:"md",MJPG:"mjpg",MKA:"mka",MKS:"mks",MKV:"mkv",MOV:"mov",MP3:"mp3",MP4:"mp4",MPD:"mpd",MPEG:"mpeg",MPG:"mpg",MXF:"mxf",ODP:"odp",ODT:"odt",OGA:"oga",OGG:"ogg",OGV:"ogv",OTF:"otf",P12:"p12",PDF:"pdf",PEM:"pem",PLAYFILE_RULE:"playfile-rule",PLAYFOLDER:"playfolder",PLAYFOLDER_RULE:"playfolder-rule",PLAYLIST:"playlist",PNG:"png",PPK:"ppk",PPS:"pps",PPSX:"ppsx",PPT:"ppt",PPTX:"pptx",PS:"ps",SDP:"sdp",SMIL:"smil",SRT:"srt",SVG:"svg",SWF:"swf",TS:"ts",TSV:"tsv",TTC:"ttc",TTF:"ttf",TXT:"txt",URI:"uri",VOB:"vob",VTT:"vtt",WEBM:"webm",WGT:"wgt",WMA:"wma",WMV:"wmv",WOFF:"woff",WOFF2:"woff2",XLS:"xls",XLSX:"xlsx",XML:"xml",XMP:"xmp",XPF:"xpf",XSLT:"xslt",XSPF:"xspf",ZIP:"zip"},P={APPLICATION_APPI:"application/appi",APPLICATION_APPLEFILE:"application/applefile",APPLICATION_BINHEX:"application/mac-binhex40",APPLICATION_BROTLI:"application/brotli",APPLICATION_COMPRESS:"application/x-compress",APPLICATION_COMPRESS2:"application/compress",APPLICATION_DASH:"application/dash+xml",APPLICATION_ECMASCRIPT:"application/ecmascript",APPLICATION_EOT:"application/vnd.ms-fontobject",APPLICATION_FONT_TTF:"application/x-font-ttf",APPLICATION_FONT_WOFF:"application/x-font-woff",APPLICATION_FONT_WOFF2:"application/x-font-woff2",APPLICATION_FORTEZZA_CKL:"application/x-fortezza-ckl",APPLICATION_FORTEZZA_KRL:"application/x-fortezza-krl",APPLICATION_FRM:"application/vnd.innes.firmware",APPLICATION_GZIP:"application/x-gzip",APPLICATION_GZIP2:"application/gzip",APPLICATION_GZIP3:"application/x-gunzip",APPLICATION_HTTP_INDEX_FORMAT:"application/http-index-format",APPLICATION_JAVAARCHIVE:"application/java-archive",APPLICATION_JAVASCRIPT:"application/javascript",APPLICATION_JSON:"application/json",APPLICATION_M3U8:"application/vnd.apple.mpegurl",APPLICATION_MACBINARY:"application/x-macbinary",APPLICATION_MAFF:"application/x-maff",APPLICATION_MARIMBA:"application/marimba",APPLICATION_MATHML_XML:"application/mathml+xml",APPLICATION_MS_EXCEL:"application/vnd.ms-excel",APPLICATION_MS_POWERPOINT:"application/vnd.ms-powerpoint",APPLICATION_MXF:"application/mxf",APPLICATION_NETSCAPE_REVOCATION:"application/x-netscape-revocation",APPLICATION_NS_JAVASCRIPT_AUTOCONFIG:"application/x-javascript-config",APPLICATION_NS_PROXY_AUTOCONFIG:"application/x-ns-proxy-autoconfig",APPLICATION_OCTET_STREAM:"application/octet-stream",APPLICATION_ODP:"application/vnd.oasis.opendocument.presentation",APPLICATION_ODT:"application/vnd.oasis.opendocument.text",APPLICATION_OF_OD_PM_PRESENTATION:"application/vnd.openxmlformats-officedocument.presentationml.presentation",APPLICATION_OF_OD_PM_SLIDESHOW:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",APPLICATION_OF_OD_SM_SHEET:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",APPLICATION_OGG:"application/ogg",APPLICATION_OLEOBJECT:"application/oleobject",APPLICATION_OLEOBJECT2:"application/x-oleobject",APPLICATION_P12:"application/x-pkcs12",APPLICATION_PACKAGE:"application/package",APPLICATION_PDF:"application/pdf",APPLICATION_PGP:"application/pgp",APPLICATION_PGP2:"application/x-pgp-message",APPLICATION_PKCS7_MIME:"application/pkcs7-mime",APPLICATION_PKCS7_SIGNATURE:"application/pkcs7-signature",APPLICATION_PLAYFILE_RULE_XML:"application/playfile-rule+xml",APPLICATION_PLAYFOLDER_RULE_XML:"application/playfolder-rule+xml",APPLICATION_PLAYFOLDER_XML:"application/playfolder+xml",APPLICATION_PLAYLIST_XML:"application/playlist+xml",APPLICATION_POSTSCRIPT:"application/postscript",APPLICATION_PRE_ENCRYPTED:"application/pre-encrypted",APPLICATION_RDF_XML:"application/rdf+xml",APPLICATION_SDP:"application/sdp",APPLICATION_SHOCKWAVE_FLASH:"application/x-shockwave-flash",APPLICATION_SMIL_XML:"application/smil+xml",APPLICATION_SMOOTHSTREAMING:"application/vnd.ms-sstr+xml",APPLICATION_URI_XML:"application/uri+xml",APPLICATION_UUENCODE:"application/x-uuencode",APPLICATION_UUENCODE2:"application/x-uue",APPLICATION_UUENCODE3:"application/uuencode",APPLICATION_UUENCODE4:"application/uue",APPLICATION_WEB_MANIFEST:"application/manifest+json",APPLICATION_WGT:"application/widget",APPLICATION_WWW_FORM_URLENCODED:"application/x-www-form-urlencoded",APPLICATION_X509_CA_CERT:"application/x-x509-ca-cert",APPLICATION_X509_CRL:"application/x-pkcs7-crl",APPLICATION_X509_EMAIL_CERT:"application/x-x509-email-cert",APPLICATION_X509_SERVER_CERT:"application/x-x509-server-cert",APPLICATION_X509_USER_CERT:"application/x-x509-user-cert",APPLICATION_XHTML_XML:"application/xhtml+xml",APPLICATION_XJAVASCRIPT:"application/x-javascript",APPLICATION_XMARIMBA:"application/x-marimba",APPLICATION_XML:"application/xml",APPLICATION_XPF_XML:"application/xpf+xml",APPLICATION_XPINSTALL:"application/x-xpinstall",APPLICATION_XPKCS7_MIME:"application/x-pkcs7-mime",APPLICATION_XPKCS7_SIGNATURE:"application/x-pkcs7-signature",APPLICATION_XSLT_XML:"application/xslt+xml",APPLICATION_XSPF_XML:"application/xspf+xml",APPLICATION_ZIP:"application/zip",AUDIO_3GPP:"audio/3gpp",AUDIO_3GPP2:"audio/3gpp2",AUDIO_AMR:"audio/amr",AUDIO_BASIC:"audio/basic",AUDIO_FLAC:"audio/flac",AUDIO_MATROSKA:"audio/x-matroska",AUDIO_MIDI:"audio/x-midi",AUDIO_MP3:"audio/mpeg",AUDIO_MP4:"audio/mp4",AUDIO_OGG:"audio/ogg",AUDIO_WAV:"audio/x-wav",AUDIO_WEBM:"audio/webm",AUDIO_WMA:"audio/x-ms-wma",BINARY_OCTET_STREAM:"binary/octet-stream",FONT_OTF:"font/otf",FONT_TTC:"font/collection",FONT_TTF:"font/ttf",FONT_WOFF:"font/woff",FONT_WOFF2:"font/woff2",IMAGE_ART:"image/x-jg",IMAGE_BMP:"image/bmp",IMAGE_BMP_MS:"image/x-ms-bmp",IMAGE_GIF:"image/gif",IMAGE_ICO:"image/x-icon",IMAGE_ICON_MS:"image/icon",IMAGE_ICO_MS:"image/vnd.microsoft.icon",IMAGE_JNG:"image/x-jng",IMAGE_JPEG:"image/jpeg",IMAGE_JPG:"image/jpg",IMAGE_MNG:"video/x-mng",IMAGE_PJPEG:"image/pjpeg",IMAGE_PNG:"image/png",IMAGE_PPK:"image/ppk",IMAGE_PPM:"image/x-portable-pixmap",IMAGE_SVG_XML:"image/svg+xml",IMAGE_TIFF:"image/tiff",IMAGE_XBM:"image/x-xbitmap",IMAGE_XBM2:"image/x-xbm",IMAGE_XBM3:"image/xbm",IMAGE_X_PNG:"image/x-png",MESSAGE_EXTERNAL_BODY:"message/external-body",MESSAGE_NEWS:"message/news",MESSAGE_RFC822:"message/rfc822",MULTIPART_ALTERNATIVE:"multipart/alternative",MULTIPART_APPLEDOUBLE:"multipart/appledouble",MULTIPART_BYTERANGES:"multipart/byteranges",MULTIPART_DIGEST:"multipart/digest",MULTIPART_FORM_DATA:"multipart/form-data",MULTIPART_HEADER_SET:"multipart/header-set",MULTIPART_MIXED:"multipart/mixed",MULTIPART_MIXED_REPLACE:"multipart/x-mixed-replace",MULTIPART_PARALLEL:"multipart/parallel",MULTIPART_RELATED:"multipart/related",MULTIPART_SIGNED:"multipart/signed",SUN_ATTACHMENT:"x-sun-attachment",TETX_TAB_SEPARATED_VALUES:"text/tab-separated-values",TEXT_CACHE_MANIFEST:"text/cache-manifest",TEXT_CALENDAR:"text/calendar",TEXT_CSS:"text/css",TEXT_CSV:"text/csv",TEXT_ECMASCRIPT:"text/ecmascript",TEXT_ENRICHED:"text/enriched",TEXT_EVENT_STREAM:"text/event-stream",TEXT_HTML:"text/html",TEXT_JAVASCRIPT:"text/javascript",TEXT_JSON:"text/json",TEXT_JSSS:"text/jsss",TEXT_LOG:"text/log",TEXT_MD:"text/markdown",TEXT_MDL:"text/mdl",TEXT_PLAIN:"text/plain",TEXT_RDF:"text/rdf",TEXT_RICHTEXT:"text/richtext",TEXT_SRT:"text/srt",TEXT_VCARD:"text/vcard",TEXT_VTT:"text/vtt",TEXT_XML:"text/xml",TEXT_XSL:"text/xsl",TEXT_XUL:"application/vnd.mozilla.xul+xml",VIDEO_3GPP:"video/3gpp",VIDEO_3GPP2:"video/3gpp2",VIDEO_AVI:"video/avi",VIDEO_JPEG:"video/JPEG",VIDEO_MATROSKA:"video/x-matroska",VIDEO_MP4:"video/mp4",VIDEO_MPEG:"video/mpeg",VIDEO_MPEG_TS:"video/mp2t",VIDEO_MS_ASF:"video/x-ms-asf",VIDEO_OGG:"video/ogg",VIDEO_QUICKTIME:"video/quicktime",VIDEO_RAW:"video/x-raw-yuv",VIDEO_RTP:"video/rtp",VIDEO_WEBM:"video/webm",VIDEO_WMV:"video/x-ms-wmv"},M={get X(){const t={},i=[P.APPLICATION_X509_CA_CERT,P.APPLICATION_X509_EMAIL_CERT,P.APPLICATION_X509_SERVER_CERT,P.APPLICATION_X509_USER_CERT];return t[p.APNG]=[P.IMAGE_PNG],t[p.APPI]=[P.APPLICATION_APPI],t[p.ASF]=[P.VIDEO_MS_ASF],t[p.AVI]=[P.VIDEO_AVI],t[p.BEM]=[P.APPLICATION_OCTET_STREAM],t[p.CRT]=i,t[p.CSS]=[P.TEXT_CSS],t[p.CSV]=[P.TEXT_CSV],t[p.DER]=i,t[p.EOF]=[P.APPLICATION_EOT],t[p.EOT]=[P.APPLICATION_EOT],t[p.EPK]=[P.APPLICATION_OCTET_STREAM],t[p.EXE]=[P.APPLICATION_OCTET_STREAM],t[p.FRM]=[P.APPLICATION_FRM],t[p.GIF]=[P.IMAGE_GIF],t[p.HTM]=[P.TEXT_HTML],t[p.HTML]=[P.TEXT_HTML],t[p.ICS]=[P.TEXT_CALENDAR],t[p.ISM]=[P.APPLICATION_SMOOTHSTREAMING,P.APPLICATION_XML],t[p.ISMC]=[P.APPLICATION_XML],t[p.JPEG]=[P.IMAGE_JPEG],t[p.JPG]=[P.IMAGE_JPEG],t[p.JS]=[P.APPLICATION_JAVASCRIPT],t[p.JSON]=[P.APPLICATION_JSON],t[p.LOG]=[P.TEXT_LOG],t[p.M2V]=[P.VIDEO_MPEG],t[p.M3U8]=[P.APPLICATION_M3U8],t[p.M4A]=[P.AUDIO_MP4],t[p.M4V]=[P.VIDEO_MP4],t[p.MAF]=[P.APPLICATION_MAFF],t[p.MAFF]=[P.APPLICATION_MAFF],t[p.MANIFEST]=[P.TEXT_CACHE_MANIFEST],t[p.MD]=[P.TEXT_MD],t[p.MJPG]=[P.VIDEO_JPEG],t[p.MKA]=[P.AUDIO_MATROSKA],t[p.MKS]=[P.VIDEO_MATROSKA],t[p.MKV]=[P.VIDEO_MATROSKA],t[p.MOV]=[P.VIDEO_QUICKTIME],t[p.MP3]=[P.AUDIO_MP3],t[p.MP4]=[P.VIDEO_MP4],t[p.MPD]=[P.APPLICATION_DASH],t[p.MPEG]=[P.VIDEO_MPEG],t[p.MPG]=[P.VIDEO_MPEG],t[p.MXF]=[P.APPLICATION_MXF],t[p.ODP]=[P.APPLICATION_ODP],t[p.ODT]=[P.APPLICATION_ODT],t[p.OGA]=[P.AUDIO_OGG],t[p.OGG]=[P.VIDEO_OGG],t[p.OGV]=[P.VIDEO_OGG],t[p.OTF]=[P.FONT_OTF],t[p.P12]=[P.APPLICATION_P12],t[p.PDF]=[P.APPLICATION_PDF],t[p.PEM]=i,t[p.PLAYFILE_RULE]=[P.APPLICATION_PLAYFILE_RULE_XML,P.APPLICATION_XML],t[p.PLAYFOLDER_RULE]=[P.APPLICATION_PLAYFOLDER_RULE_XML,P.APPLICATION_XML],t[p.PLAYFOLDER]=[P.APPLICATION_PLAYFOLDER_XML,P.APPLICATION_XML],t[p.PLAYLIST]=[P.APPLICATION_PLAYLIST_XML,P.APPLICATION_XML],t[p.PNG]=[P.IMAGE_PNG],t[p.PPK]=[P.IMAGE_PPK],t[p.PPS]=[P.APPLICATION_MS_POWERPOINT],t[p.PPSX]=[P.APPLICATION_OF_OD_PM_SLIDESHOW],t[p.PPT]=[P.APPLICATION_MS_POWERPOINT],t[p.PPTX]=[P.APPLICATION_OF_OD_PM_PRESENTATION],t[p.PS]=[P.VIDEO_MPEG],t[p.SDP]=[P.APPLICATION_SDP],t[p.SMIL]=[P.APPLICATION_SMIL_XML,P.APPLICATION_XML],t[p.SRT]=[P.TEXT_SRT],t[p.SVG]=[P.IMAGE_SVG_XML],t[p.SWF]=[P.APPLICATION_SHOCKWAVE_FLASH],t[p.TS]=[P.VIDEO_MPEG_TS],t[p.TSV]=[P.TETX_TAB_SEPARATED_VALUES],t[p.TTC]=[P.FONT_TTC],t[p.TTF]=[P.FONT_TTF,P.APPLICATION_FONT_TTF],t[p.TXT]=[P.TEXT_PLAIN],t[p.URI]=[P.APPLICATION_URI_XML,P.APPLICATION_XML],t[p.VOB]=[P.VIDEO_MPEG],t[p.VTT]=[P.TEXT_VTT],t[p.WEBM]=[P.VIDEO_WEBM],t[p.WGT]=[P.APPLICATION_WGT],t[p.WMA]=[P.AUDIO_WMA],t[p.WMV]=[P.VIDEO_WMV],t[p.WOFF]=[P.FONT_WOFF,P.APPLICATION_FONT_WOFF],t[p.WOFF2]=[P.FONT_WOFF2,P.APPLICATION_FONT_WOFF2],t[p.XLS]=[P.APPLICATION_MS_EXCEL],t[p.XLSX]=[P.APPLICATION_OF_OD_SM_SHEET],t[p.XML]=[P.APPLICATION_XML],t[p.XMP]=[P.APPLICATION_RDF_XML],t[p.XPF]=[P.APPLICATION_XPF_XML,P.APPLICATION_XML],t[p.XSLT]=[P.APPLICATION_XSLT_XML,P.APPLICATION_XML],t[p.XSPF]=[P.APPLICATION_XSPF_XML,P.APPLICATION_XML],t[p.ZIP]=[P.APPLICATION_ZIP],t}}.X;function n(t){const i=function(t){const i=function(t){return t.substr(t.lastIndexOf(".")+1).toLowerCase()}(t);return null!=M[i]?M[i]:[]}(t);return i.length>0?i[0]:null}function g(t){return function(t){return null!=t&&null!=t.charset}(t)?t.charset:"UTF-8"}class C extends N{read(t){return function(t){if(null==t.stats)return!1;const i=t.uri;return!(i.indexOf(":/")<0)&&O(i)}(this)?new S(this.uri,g(t),null==t?"text":t.responseType,(()=>this.h(!1).then((t=>{w(t)})))):new c(this,!1,(async(i,e,a)=>{w(i);const n=i.getInput();try{switch(null==t?"text":t.responseType){case"arraybuffer":{const t=new ArrayBuffer(i.size);return await E(n.asyncReadArrayBuffer.bind(n,i.size,t),e,a),t}case"blob":{const t=new ArrayBuffer(i.size);return await E(n.asyncReadArrayBuffer.bind(n,i.size,t),e,a),new Blob([t])}case"text":return await E(n.asyncReadIntoString.bind(n,i.size,g(t)),e,a);case"document":{const r=await E(n.asyncReadIntoString.bind(n,i.size,g(t)),e,a);return(new DOMParser).parseFromString(r,"text/xml")}case"json":{const r=await E(n.asyncReadIntoString.bind(n,i.size,g(t)),e,a);return JSON.parse(r)}}}finally{n.close()}}))}write(t,i){return new c(this,!0,(async(e,a,n)=>{if((null==i||!i.overwrite)&&e.exists)throw new Error("E_ALREADY_EXISTS");if(!(await this.parent.h(!1)).exists)throw new Error("E_PARENT_DIRECTORY_NOT_EXISTS");if(!e.canWrite)throw new Error("E_ACCESS_DENIED");let r;if(t instanceof ArrayBuffer)0!==t.byteLength&&(r=ioManager.newInputStreamFromArrayBuffer(t.byteLength,t));else if(t instanceof Blob){if(0!==t.size)try{r=ioManager.newInputStreamFromBlob(t)}catch{const i=await new Promise(((i,e)=>{const a=new FileReader;a.addEventListener("error",(()=>{e(new Error("E_INTERNAL_ERROR"))})),a.addEventListener("load",(function(){null==this.result?e(new Error("E_INTERNAL_ERROR")):i(this.result)})),a.readAsArrayBuffer(t)}));r=ioManager.newInputStreamFromArrayBuffer(i.byteLength,i)}}else if(t instanceof Document){const e=(new XMLSerializer).serializeToString(t);r=ioManager.newInputStreamFromString(e,g(i))}else{let e=t;"string"!=typeof e&&(e=JSON.stringify(t)),0!==e.length&&(r=ioManager.newInputStreamFromString(e,g(i)))}if(null==r)e.exists&&await E(e.asyncDelete.bind(e)),await E(e.asyncCreateFile.bind(e)),await this.T(!0);else{const t=ioTransactionManager.create();let i=!1;try{let o=0;const l=t.asyncPut.bind(t,e.path,e,r);for(;;){const i=r.available();if(0===i)break;if(!e.verifySpaceAvailable(i))throw new Error("E_NO_MORE_SPACE");await E(l.bind(t,0===o,o,i),a,n),o+=i}try{t.commit()}catch{throw new Error("E_NETWORK")}await this.T(!0),i=!0}finally{i||t.rollback()}}}))}copy(t,i,e){if("string"!=typeof i&&(e=i,i=this.name),!(t instanceof s))throw new Error("E_INVALID_ARG");const a=t;return new c(this,!1,(async(t,n,r)=>{w(t);if(!(await a.h(!0)).exists)throw new Error("E_PARENT_DIRECTORY_NOT_EXISTS");const o=a.newFile(i);if(o.path===this.path)throw new Error("E_INVALID_ARG");const l=await o.h(!0);if(!l.canWrite)throw new Error("E_ACCESS_DENIED");const s=this.stats;if(null!=s.contentLength&&!l.verifySpaceAvailable(s.contentLength))throw new Error("E_NO_MORE_SPACE");if((null==e||!0!==e.overwrite)&&l.exists)throw new Error("E_ALREADY_EXISTS");let c=ioTransactionManager.create();try{const i=t.size;n(0,i);try{await E(c.asyncCopy.bind(c,l.path,t,l),((t,i)=>n(t,i)),r),await E(c.asyncCommit.bind(c))}catch{throw new Error("E_NETWORK")}return n(i,i),c=null,await o.T(!0),o}finally{null!=c&&await E(c.asyncRollback.bind(c))}}))}unlink(){return new c(this,!0,(async t=>{t.exists&&(await E(t.asyncDelete.bind(t)),await this.T(!1))}))}O(t,i){super.O(t,i);try{t.contentLength=i.size}catch{}const e=this.name.lastIndexOf(".");if(e>0){const i=n(this.name.substr(e+1));null!=i&&(t.contentType=i)}}}Object.defineProperties(C.prototype,{type:{value:"file"}}),s=I,a=C;export{f as root};